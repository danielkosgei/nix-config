# NixOS configuration

## Overview

This repository contains a flake-based NixOS setup with integrated Home Manager. It defines multiple hosts and composes user programs and development tooling via reusable Home Manager modules.

## Repository layout

- `flake.nix`: Flake entrypoint. Declares inputs like `nixpkgs`, `home-manager`, `nixos-hardware`, `nix-topology`, `spicetify-nix`, `zen-browser`, and wires outputs.
- `hosts/`
  - `shadow/`
    - `configuration.nix`: System configuration for host `shadow` (imports Home Manager).
    - `hardware-configuration.nix`: Auto-generated by `nixos-generate-config`.
    - `home.nix`: User-specific Home Manager configuration for `danny` on `shadow`.
- `modules/home-manager/`
  - `development/`
    - `default.nix`: Aggregates development modules.
    - `ides.nix`: IDE packages (e.g., `neovim`, `code-cursor-fhs`).
    - `tools.nix`: CLI/dev tools configuration.
    - `zeditor.nix`: Additional editor-related config.
  - `programs/`
    - `default.nix`: Aggregates program modules.
    - `misc/`: Assorted program configs (e.g., `bat.nix`, `git.nix`, `kitty.nix`, `lf.nix`, `nushell.nix`, `obsidian.nix`, `spotify.nix`).
    - `mpv/`: MPV player configuration.
    - `zathura/`: Zathura PDF viewer configuration.
- `topology.nix`: Network/service topology using `nix-topology` overlay.

## Flake outputs

- `nixosConfigurations.shadow`: Main laptop configuration (ThinkPad T490 hardware module).
- `nixosConfigurations.reaper`: PC configuration.
- `topology.x86_64-linux`: Topology output generated from `topology.nix` and hosts.

## Quickstart

1. Clone your repo and enter it:

   ```bash
   git clone <this-repo-url>
   cd shadow
   ```

2. Build and switch for a host (example: `shadow`):

   ```bash
   sudo nixos-rebuild switch --flake .#shadow
   ```

3. For another host (example: `reaper`):

   ```bash
   sudo nixos-rebuild switch --flake .#reaper
   ```

Home Manager is integrated via `home-manager.nixosModules.default`, so user configuration under `hosts/<host>/home.nix` is applied as part of the system rebuild.

## Common tasks

- Update inputs and rebuild:

  ```bash
  nix flake update
  sudo nixos-rebuild switch --flake .#shadow
  ```

- Build without switching (dry-run build):

  ```bash
  nix build .#nixosConfigurations.shadow.config.system.build.toplevel
  ```

## Notes

- Hardware-specific modules are included via `nixos-hardware` (e.g., `lenovo-thinkpad-t490`).
- `nix-topology` overlay is enabled in `flake.nix` and used by `topology.nix` for visualization/analysis.
- Some development modules (e.g., `neovim.nix`, `vscode.nix`) are present but may be commented out in `development/default.nix`; enable as needed.
